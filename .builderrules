# üß† **Builder AI Agent Fusion Copilot ‚Äì MADAR AI Model Definition**

**Agent Role**: Advanced Fullstack Visual Copilot  
**Purpose**: Develop, extend, and maintain the MADAR AI creative image generation platform with enterprise-grade AI integrations.

---

## üöÄ **üîπ PROJECT:** `MADAR AI` 

**Meaning:** "Orbit" in Arabic ‚Äì A 100% free creative tool for Arabic-speaking designers.

**Vision:**
> MADAR empowers users to upload ideas, select stunning 3D/voxel styles, and generate transparent AI art through enterprise-grade AI gateways.

---

## üí° **üîπ PROJECT PURPOSE & EVOLUTION**

MADAR AI is an enterprise-ready AI-powered design assistant for Arabic-speaking creatives featuring:

### **Core Features:**
* **Multi-Provider AI Integration** - Vercel AI Gateway + Fal AI + OpenAI fallbacks
* **Dynamic Model Discovery** - Real-time model availability and cost optimization  
* **Style-Based Generation** - 3D styles (Minecraft voxel, clay, low-poly) with JSON prompt injection
* **Enterprise Analytics** - Built-in monitoring, caching, and usage tracking
* **Transparent PNG Output** - High-quality images with transparent backgrounds
* **Personal Gallery System** - Save and organize generated artwork
* **RTL Arabic Support** - Full right-to-left interface design

### **Enterprise Features:**
* **Monthly Quotas** - 30 free generations per user per month
* **AI Gateway Routing** - Intelligent provider selection and cost optimization
* **Advanced Observability** - Request tracing, performance metrics, and usage analytics
* **Multi-Model Support** - Seamless switching between AI providers

---

## üèóÔ∏è **üîπ CURRENT SYSTEM ARCHITECTURE**

### **Frontend Stack:**
```
Next.js 14 (App Router) + Once UI System + Tailwind CSS + TypeScript
‚îú‚îÄ‚îÄ Authentication: Google OAuth2 (NextAuth.js)
‚îú‚îÄ‚îÄ UI Framework: Once UI Design System (strict adherence required)  
‚îú‚îÄ‚îÄ Styling: Tailwind CSS utilities only
‚îú‚îÄ‚îÄ State Management: React hooks + custom API hooks
‚îî‚îÄ‚îÄ RTL Support: Full Arabic right-to-left layout support
```

### **AI Integration Layer:**
```
Vercel AI SDK v5 (PRIMARY - NEVER use direct APIs)
‚îú‚îÄ‚îÄ ü•á Primary: Vercel AI Gateway (gpt-image-1 model)
‚îú‚îÄ‚îÄ ü•à Backup: Fal AI (fal-ai/fast-sdxl)  
‚îú‚îÄ‚îÄ ü•â Optional: OpenAI Direct (dall-e-3, dall-e-2)
‚îî‚îÄ‚îÄ Dynamic Discovery: /api/models endpoint for real-time availability
```

### **Backend & Database:**
```
API Routes (Next.js) + Neon PostgreSQL + Drizzle ORM
‚îú‚îÄ‚îÄ Database: Neon (Postgres) for users, images, styles
‚îú‚îÄ‚îÄ ORM: Drizzle for type-safe database operations
‚îú‚îÄ‚îÄ Authentication: NextAuth.js session management
‚îî‚îÄ‚îÄ File Handling: Direct image streaming (no CDN currently)
```

---

## üîó **üîπ AI GATEWAY ARCHITECTURE (CRITICAL)**

### **üö® MANDATORY: Always Use Vercel AI SDK v5**
```typescript
// ‚úÖ CORRECT: Use Vercel AI SDK 
import { generateImage } from 'ai';
import { createProviderInstance } from './ai-gateway-config';

// ‚ùå NEVER: Direct API calls
// fetch('https://api.openai.com/...')  // FORBIDDEN
```

### **Current Provider Configuration:**
```typescript
// Located in: api/ai-gateway-config.ts
PROVIDER_CONFIGS = {
  "vercel-gateway": {
    id: "vercel-gateway",
    baseURL: "https://api.vercel.com/v1/ai",
    apiKey: process.env.VERCEL_AI_GATEWAY_KEY, // pILy0A986lbdtYyvRkdmacgN
    models: ["gpt-image-1"]
  },
  "fal": {
    apiKey: process.env.FAL_KEY,
    models: ["fal-ai/fast-sdxl"]
  },
  "openai": {
    baseURL: process.env.OPENAI_GATEWAY_URL || "https://api.openai.com/v1",
    apiKey: process.env.OPENAI_API_KEY,
    models: ["dall-e-3", "dall-e-2"]
  }
}
```

### **Model Priority Hierarchy:**
1. **ü•á gpt-image-1** (Vercel Gateway) - Primary, enterprise features
2. **ü•à fal-ai/fast-sdxl** (Fal AI) - Fast backup option  
3. **ü•â dall-e-3** (OpenAI) - Premium quality fallback
4. **dall-e-2** (OpenAI) - Cost-effective option

---

## üìä **üîπ DATABASE SCHEMA (Neon + Drizzle)**

```typescript
// lib/schema.ts - Current schema
export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: text('name'),
  email: text('email'),
  generation_count: integer('generation_count').default(0),
  reset_date: timestamp('reset_date')
});

export const images = pgTable('images', {
  id: serial('id').primaryKey(), 
  user_id: integer('user_id').references(() => users.id),
  image_url: text('image_url'),
  prompt: text('prompt'),
  style_name: text('style_name'),
  model_used: text('model_used'), // NEW: Track which AI model generated
  colors: text('colors'), // JSON array
  created_at: timestamp('created_at').defaultNow()
});

export const styles = pgTable('styles', {
  id: serial('id').primaryKey(),
  name: text('name'),
  description: text('description'),
  thumbnail_url: text('thumbnail_url'),
  prompt_json: text('prompt_json') // Complete prompt template
});
```

---

## üõ£Ô∏è **üîπ API ROUTES & INTEGRATIONS**

### **Core Generation Flow:**
```typescript
// api/generate.ts - Enhanced multi-provider generation
POST /api/generate
‚îú‚îÄ‚îÄ Input: { prompt, styleId, model, colors[], aspectRatio }
‚îú‚îÄ‚îÄ Process: 
‚îÇ   ‚îú‚îÄ‚îÄ Validate user quota (30/month)
‚îÇ   ‚îú‚îÄ‚îÄ Get provider via createProviderInstance(model)
‚îÇ   ‚îú‚îÄ‚îÄ Generate via Vercel AI SDK generateImage()
‚îÇ   ‚îú‚îÄ‚îÄ Track usage & analytics
‚îÇ   ‚îî‚îÄ‚îÄ Return: { success, imageUrl, metadata }
‚îî‚îÄ‚îÄ Models Supported: gpt-image-1, fal-ai/fast-sdxl, dall-e-3, dall-e-2
```

### **Dynamic Model Discovery:**
```typescript
// api/models.ts - Real-time model availability  
GET /api/models
‚îú‚îÄ‚îÄ Checks: Environment variables for each provider
‚îú‚îÄ‚îÄ Validates: API key configuration
‚îú‚îÄ‚îÄ Returns: Available models with metadata
‚îî‚îÄ‚îÄ Format: { id, name, provider, cost, estimatedTime, isAvailable }
```

### **Enhanced API Endpoints:**
```typescript
// Current endpoints with AI Gateway integration
/api/generate     // Multi-provider image generation via Vercel AI SDK
/api/models       // Dynamic model discovery and availability
/api/save         // Store generated images with model tracking
/api/user         // User stats + generation quota management
/api/styles       // (Admin) CRUD for prompt templates
/api/users        // (Admin) User management + quota resets
```

---

## üéØ **üîπ FRONTEND INTEGRATION POINTS**

### **Generator Page (client/pages/Generator.tsx):**
```typescript
// Key integration points:
‚îú‚îÄ‚îÄ Line ~1110: Enhanced loading states with model-specific messaging
‚îú‚îÄ‚îÄ Line ~1167: onGenerate() function with multi-provider logic
‚îú‚îÄ‚îÄ Line ~1225: Dynamic image display container
‚îú‚îÄ‚îÄ Model Selection: Real-time dropdown with cost/time estimates
‚îî‚îÄ‚îÄ Quota Display: Live generation count with reset date
```

### **Generation Form Component:**
```typescript
// client/components/generator/GenerationForm.tsx
‚îú‚îÄ‚îÄ Dynamic Model Loading: Fetches /api/models on mount
‚îú‚îÄ‚îÄ Model Cards: Provider badges, cost, estimated time
‚îú‚îÄ‚îÄ Availability Status: Real-time checking of API keys
‚îú‚îÄ‚îÄ Default Model: gpt-image-1 (Vercel Gateway)
‚îî‚îÄ‚îÄ Fallback Models: Graceful degradation to available providers
```

### **Gallery Integration:**
```typescript
// client/pages/Gallery.tsx
‚îú‚îÄ‚îÄ Model Tracking: Display which AI model generated each image
‚îú‚îÄ‚îÄ Provider Analytics: Group images by provider/model
‚îú‚îÄ‚îÄ Cost Tracking: Show per-image generation costs
‚îî‚îÄ‚îÄ Performance Metrics: Display generation times
```

---

## üîß **üîπ ENVIRONMENT CONFIGURATION**

### **Required Environment Variables:**
```bash
# PRIMARY: Vercel AI Gateway (configured)
VERCEL_AI_GATEWAY_KEY=pILy0A986lbdtYyvRkdmacgN
VERCEL_AI_GATEWAY_URL=https://api.vercel.com/v1/ai

# BACKUP: Fal AI
FAL_KEY=your_fal_ai_api_key_here

# OPTIONAL: Direct OpenAI  
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_GATEWAY_URL=https://api.openai.com/v1

# DATABASE: Neon PostgreSQL
DATABASE_URL=your_neon_database_url

# AUTH: Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
NEXTAUTH_URL=http://localhost:8080
NEXTAUTH_SECRET=your_nextauth_secret
```

---

## üß† **üîπ AGENT BEHAVIOR RULES**

### **‚úÖ MANDATORY DOs:**

1. **AI Integration Rules:**
   - ‚úÖ **ALWAYS use Vercel AI SDK v5** - Never direct API calls
   - ‚úÖ **Route through ai-gateway-config.ts** for all AI operations
   - ‚úÖ **Support multi-provider fallbacks** automatically
   - ‚úÖ **Track model usage** in database for analytics

2. **UI/UX Standards:**
   - ‚úÖ **Once UI System only** - No external component libraries
   - ‚úÖ **Tailwind CSS utilities only** - No custom CSS
   - ‚úÖ **RTL Arabic support** - All text and layouts
   - ‚úÖ **Minimal, clean design** - Follow existing patterns

3. **Code Structure:**
   - ‚úÖ **Work within existing files** - Don't create new layout systems
   - ‚úÖ **Use TypeScript strictly** - Full type safety
   - ‚úÖ **Follow Drizzle ORM patterns** - For database operations
   - ‚úÖ **Implement proper error handling** - With user-friendly messages

### **‚ùå CRITICAL DON'Ts:**

1. **Forbidden Practices:**
   - ‚ùå **NO direct API calls** - Must use Vercel AI SDK
   - ‚ùå **NO external UI libraries** - MUI/Chakra/Ant Design forbidden
   - ‚ùå **NO custom CSS files** - Tailwind utilities only
   - ‚ùå **NO layout system changes** - Respect Once UI structure

2. **AI Integration Restrictions:**
   - ‚ùå **NO bypassing ai-gateway-config.ts** - All providers must go through it
   - ‚ùå **NO hardcoded API endpoints** - Use environment variables
   - ‚ùå **NO ignoring quota limits** - Enforce 30 generations/month
   - ‚ùå **NO direct database queries** - Use Drizzle ORM

---

## üéØ **üîπ COMMON DEVELOPMENT TASKS**

### **AI Generation Enhancement:**
```typescript
// Enhance generation flow in Generator.tsx
1. Integrate model selection with real-time availability
2. Add loading states specific to each AI provider  
3. Implement cost tracking and quota warnings
4. Add generation time estimates and progress indicators
5. Handle provider failures with automatic fallbacks
```

### **Admin Dashboard Development:**
```typescript
// Build admin interfaces for:
‚îú‚îÄ‚îÄ /admin/users - User management + quota controls
‚îú‚îÄ‚îÄ /admin/styles - JSON prompt template editor
‚îú‚îÄ‚îÄ /admin/analytics - AI usage metrics and costs
‚îî‚îÄ‚îÄ /admin/models - Provider configuration and status
```

### **Database Operations:**
```typescript
// All database work through Drizzle ORM:
‚îú‚îÄ‚îÄ User quota management and reset cycles
‚îú‚îÄ‚îÄ Image metadata with model tracking
‚îú‚îÄ‚îÄ Style template CRUD operations
‚îî‚îÄ‚îÄ Analytics data aggregation
```

---

## üìä **üîπ PERFORMANCE & MONITORING**

### **AI Gateway Analytics:**
```typescript
// Built-in observability features:
‚îú‚îÄ‚îÄ Request tracing with Vercel trace IDs
‚îú‚îÄ‚îÄ Generation time monitoring
‚îú‚îÄ‚îÄ Cost tracking per model/provider
‚îú‚îÄ‚îÄ Success/failure rate analytics
‚îú‚îÄ‚îÄ Quota usage patterns
‚îî‚îÄ‚îÄ Provider performance comparison
```

### **Frontend Performance:**
```typescript
// Optimization requirements:
‚îú‚îÄ‚îÄ Lazy loading for large image galleries
‚îú‚îÄ‚îÄ Real-time model availability checking
‚îú‚îÄ‚îÄ Efficient state management for generation flows
‚îú‚îÄ‚îÄ Error boundary implementation
‚îî‚îÄ‚îÄ Loading state optimization
```

---

## üöÄ **üîπ DEPLOYMENT & SCALING**

### **Production Ready Features:**
- ‚úÖ **Enterprise AI Gateway** - Vercel infrastructure
- ‚úÖ **Multi-provider redundancy** - Automatic failover
- ‚úÖ **Usage analytics** - Comprehensive monitoring
- ‚úÖ **Cost optimization** - Intelligent model routing
- ‚úÖ **Global performance** - Edge network optimization

### **Scaling Considerations:**
- üìä **Monitor quota usage** patterns for optimization
- üîÑ **Implement caching strategies** for repeated prompts
- üìà **Track model performance** for intelligent routing
- üí∞ **Optimize costs** through usage analytics

---

## üéâ **üîπ READY FOR EXECUTION**

### **Current Development Server:**
**URL:** http://localhost:8080  
**Status:** Running with Vercel AI Gateway integration

### **Immediate Tasks Ready:**
1. ‚úÖ **AI Generation Flow** - Fully integrated with multi-provider support
2. ‚úÖ **Model Selection UI** - Dynamic discovery with real-time data
3. üöß **Admin Dashboards** - User and style management (in progress)
4. üöß **Analytics Dashboard** - Usage and cost tracking (ready for implementation)

### **Next Development Priorities:**
1. **Complete admin interfaces** for users and styles management
2. **Implement advanced analytics** for AI usage optimization  
3. **Add generation history** with detailed model tracking
4. **Enhance quota management** with usage predictions

---

## üìû **üîπ SUPPORT & DOCUMENTATION**

### **Technical Documentation:**
- **`VERCEL_AI_GATEWAY_SETUP.md`** - Complete integration guide
- **`OPENAI_SETUP.md`** - Multi-provider configuration
- **`AI_GATEWAY_IMPLEMENTATION.md`** - Architecture overview

### **Development Guidelines:**
- **Always prioritize Vercel AI SDK** over direct API integrations
- **Maintain strict UI consistency** with Once UI System
- **Implement comprehensive error handling** for all AI operations
- **Track all interactions** for analytics and optimization

---

**üéØ Your MADAR AI platform is now enterprise-ready with advanced AI gateway integration, multi-provider support, and comprehensive monitoring capabilities!**# üß† **Builder AI Agent Fusion Copilot ‚Äì MADAR AI Model Definition**

**Agent Role**: Advanced Fullstack Visual Copilot  
**Purpose**: Develop, extend, and maintain the MADAR AI creative image generation platform with enterprise-grade AI integrations.

---

## üöÄ **üîπ PROJECT:** `MADAR AI` 

**Meaning:** "Orbit" in Arabic ‚Äì A 100% free creative tool for Arabic-speaking designers.

**Vision:**
> MADAR empowers users to upload ideas, select stunning 3D/voxel styles, and generate transparent AI art through enterprise-grade AI gateways.

---

## üí° **üîπ PROJECT PURPOSE & EVOLUTION**

MADAR AI is an enterprise-ready AI-powered design assistant for Arabic-speaking creatives featuring:

### **Core Features:**
* **Multi-Provider AI Integration** - Vercel AI Gateway + Fal AI + OpenAI fallbacks
* **Dynamic Model Discovery** - Real-time model availability and cost optimization  
* **Style-Based Generation** - 3D styles (Minecraft voxel, clay, low-poly) with JSON prompt injection
* **Enterprise Analytics** - Built-in monitoring, caching, and usage tracking
* **Transparent PNG Output** - High-quality images with transparent backgrounds
* **Personal Gallery System** - Save and organize generated artwork
* **RTL Arabic Support** - Full right-to-left interface design

### **Enterprise Features:**
* **Monthly Quotas** - 30 free generations per user per month
* **AI Gateway Routing** - Intelligent provider selection and cost optimization
* **Advanced Observability** - Request tracing, performance metrics, and usage analytics
* **Multi-Model Support** - Seamless switching between AI providers

---

## üèóÔ∏è **üîπ CURRENT SYSTEM ARCHITECTURE**

### **Frontend Stack:**
```
Next.js 14 (App Router) + Once UI System + Tailwind CSS + TypeScript
‚îú‚îÄ‚îÄ Authentication: Google OAuth2 (NextAuth.js)
‚îú‚îÄ‚îÄ UI Framework: Once UI Design System (strict adherence required)  
‚îú‚îÄ‚îÄ Styling: Tailwind CSS utilities only
‚îú‚îÄ‚îÄ State Management: React hooks + custom API hooks
‚îî‚îÄ‚îÄ RTL Support: Full Arabic right-to-left layout support
```

### **AI Integration Layer:**
```
Vercel AI SDK v5 (PRIMARY - NEVER use direct APIs)
‚îú‚îÄ‚îÄ ü•á Primary: Vercel AI Gateway (gpt-image-1 model)
‚îú‚îÄ‚îÄ ü•à Backup: Fal AI (fal-ai/fast-sdxl)  
‚îú‚îÄ‚îÄ ü•â Optional: OpenAI Direct (dall-e-3, dall-e-2)
‚îî‚îÄ‚îÄ Dynamic Discovery: /api/models endpoint for real-time availability
```

### **Backend & Database:**
```
API Routes (Next.js) + Neon PostgreSQL + Drizzle ORM
‚îú‚îÄ‚îÄ Database: Neon (Postgres) for users, images, styles
‚îú‚îÄ‚îÄ ORM: Drizzle for type-safe database operations
‚îú‚îÄ‚îÄ Authentication: NextAuth.js session management
‚îî‚îÄ‚îÄ File Handling: Direct image streaming (no CDN currently)
```

---

## üîó **üîπ AI GATEWAY ARCHITECTURE (CRITICAL)**

### **üö® MANDATORY: Always Use Vercel AI SDK v5**
```typescript
// ‚úÖ CORRECT: Use Vercel AI SDK 
import { generateImage } from 'ai';
import { createProviderInstance } from './ai-gateway-config';

// ‚ùå NEVER: Direct API calls
// fetch('https://api.openai.com/...')  // FORBIDDEN
```

### **Current Provider Configuration:**
```typescript
// Located in: api/ai-gateway-config.ts
PROVIDER_CONFIGS = {
  "vercel-gateway": {
      id: "vercel-gateway",
          baseURL: "https://api.vercel.com/v1/ai",
              apiKey: process.env.VERCEL_AI_GATEWAY_KEY, // pILy0A986lbdtYyvRkdmacgN
                  models: ["gpt-image-1"]
                    },
                      "fal": {
                          apiKey: process.env.FAL_KEY,
                              models: ["fal-ai/fast-sdxl"]
                                },
                                  "openai": {
                                      baseURL: process.env.OPENAI_GATEWAY_URL || "https://api.openai.com/v1",
                                          apiKey: process.env.OPENAI_API_KEY,
                                              models: ["dall-e-3", "dall-e-2"]
                                                }
                                                }
                                                ```

                                                ### **Model Priority Hierarchy:**
                                                1. **ü•á gpt-image-1** (Vercel Gateway) - Primary, enterprise features
                                                2. **ü•à fal-ai/fast-sdxl** (Fal AI) - Fast backup option  
                                                3. **ü•â dall-e-3** (OpenAI) - Premium quality fallback
                                                4. **dall-e-2** (OpenAI) - Cost-effective option

                                                ---

                                                ## üìä **üîπ DATABASE SCHEMA (Neon + Drizzle)**

                                                ```typescript
                                                // lib/schema.ts - Current schema
                                                export const users = pgTable('users', {
                                                  id: serial('id').primaryKey(),
                                                    name: text('name'),
                                                      email: text('email'),
                                                        generation_count: integer('generation_count').default(0),
                                                          reset_date: timestamp('reset_date')
                                                          });

                                                          export const images = pgTable('images', {
                                                            id: serial('id').primaryKey(), 
                                                              user_id: integer('user_id').references(() => users.id),
                                                                image_url: text('image_url'),
                                                                  prompt: text('prompt'),
                                                                    style_name: text('style_name'),
                                                                      model_used: text('model_used'), // NEW: Track which AI model generated
                                                                        colors: text('colors'), // JSON array
                                                                          created_at: timestamp('created_at').defaultNow()
                                                                          });

                                                                          export const styles = pgTable('styles', {
                                                                            id: serial('id').primaryKey(),
                                                                              name: text('name'),
                                                                                description: text('description'),
                                                                                  thumbnail_url: text('thumbnail_url'),
                                                                                    prompt_json: text('prompt_json') // Complete prompt template
                                                                                    });
                                                                                    ```

                                                                                    ---

                                                                                    ## üõ£Ô∏è **üîπ API ROUTES & INTEGRATIONS**

                                                                                    ### **Core Generation Flow:**
                                                                                    ```typescript
                                                                                    // api/generate.ts - Enhanced multi-provider generation
                                                                                    POST /api/generate
                                                                                    ‚îú‚îÄ‚îÄ Input: { prompt, styleId, model, colors[], aspectRatio }
                                                                                    ‚îú‚îÄ‚îÄ Process: 
                                                                                    ‚îÇ   ‚îú‚îÄ‚îÄ Validate user quota (30/month)
                                                                                    ‚îÇ   ‚îú‚îÄ‚îÄ Get provider via createProviderInstance(model)
                                                                                    ‚îÇ   ‚îú‚îÄ‚îÄ Generate via Vercel AI SDK generateImage()
                                                                                    ‚îÇ   ‚îú‚îÄ‚îÄ Track usage & analytics
                                                                                    ‚îÇ   ‚îî‚îÄ‚îÄ Return: { success, imageUrl, metadata }
                                                                                    ‚îî‚îÄ‚îÄ Models Supported: gpt-image-1, fal-ai/fast-sdxl, dall-e-3, dall-e-2
                                                                                    ```

                                                                                    ### **Dynamic Model Discovery:**
                                                                                    ```typescript
                                                                                    // api/models.ts - Real-time model availability  
                                                                                    GET /api/models
                                                                                    ‚îú‚îÄ‚îÄ Checks: Environment variables for each provider
                                                                                    ‚îú‚îÄ‚îÄ Validates: API key configuration
                                                                                    ‚îú‚îÄ‚îÄ Returns: Available models with metadata
                                                                                    ‚îî‚îÄ‚îÄ Format: { id, name, provider, cost, estimatedTime, isAvailable }
                                                                                    ```

                                                                                    ### **Enhanced API Endpoints:**
                                                                                    ```typescript
                                                                                    // Current endpoints with AI Gateway integration
                                                                                    /api/generate     // Multi-provider image generation via Vercel AI SDK
                                                                                    /api/models       // Dynamic model discovery and availability
                                                                                    /api/save         // Store generated images with model tracking
                                                                                    /api/user         // User stats + generation quota management
                                                                                    /api/styles       // (Admin) CRUD for prompt templates
                                                                                    /api/users        // (Admin) User management + quota resets
                                                                                    ```

                                                                                    ---

                                                                                    ## üéØ **üîπ FRONTEND INTEGRATION POINTS**

                                                                                    ### **Generator Page (client/pages/Generator.tsx):**
                                                                                    ```typescript
                                                                                    // Key integration points:
                                                                                    ‚îú‚îÄ‚îÄ Line ~1110: Enhanced loading states with model-specific messaging
                                                                                    ‚îú‚îÄ‚îÄ Line ~1167: onGenerate() function with multi-provider logic
                                                                                    ‚îú‚îÄ‚îÄ Line ~1225: Dynamic image display container
                                                                                    ‚îú‚îÄ‚îÄ Model Selection: Real-time dropdown with cost/time estimates
                                                                                    ‚îî‚îÄ‚îÄ Quota Display: Live generation count with reset date
                                                                                    ```

                                                                                    ### **Generation Form Component:**
                                                                                    ```typescript
                                                                                    // client/components/generator/GenerationForm.tsx
                                                                                    ‚îú‚îÄ‚îÄ Dynamic Model Loading: Fetches /api/models on mount
                                                                                    ‚îú‚îÄ‚îÄ Model Cards: Provider badges, cost, estimated time
                                                                                    ‚îú‚îÄ‚îÄ Availability Status: Real-time checking of API keys
                                                                                    ‚îú‚îÄ‚îÄ Default Model: gpt-image-1 (Vercel Gateway)
                                                                                    ‚îî‚îÄ‚îÄ Fallback Models: Graceful degradation to available providers
                                                                                    ```

                                                                                    ### **Gallery Integration:**
                                                                                    ```typescript
                                                                                    // client/pages/Gallery.tsx
                                                                                    ‚îú‚îÄ‚îÄ Model Tracking: Display which AI model generated each image
                                                                                    ‚îú‚îÄ‚îÄ Provider Analytics: Group images by provider/model
                                                                                    ‚îú‚îÄ‚îÄ Cost Tracking: Show per-image generation costs
                                                                                    ‚îî‚îÄ‚îÄ Performance Metrics: Display generation times
                                                                                    ```

                                                                                    ---

                                                                                    ## üîß **üîπ ENVIRONMENT CONFIGURATION**

                                                                                    ### **Required Environment Variables:**
                                                                                    ```bash
                                                                                    # PRIMARY: Vercel AI Gateway (configured)
                                                                                    VERCEL_AI_GATEWAY_KEY=pILy0A986lbdtYyvRkdmacgN
                                                                                    VERCEL_AI_GATEWAY_URL=https://api.vercel.com/v1/ai

                                                                                    # BACKUP: Fal AI
                                                                                    FAL_KEY=your_fal_ai_api_key_here

                                                                                    # OPTIONAL: Direct OpenAI  
                                                                                    OPENAI_API_KEY=your_openai_api_key_here
                                                                                    OPENAI_GATEWAY_URL=https://api.openai.com/v1

                                                                                    # DATABASE: Neon PostgreSQL
                                                                                    DATABASE_URL=your_neon_database_url

                                                                                    # AUTH: Google OAuth
                                                                                    GOOGLE_CLIENT_ID=your_google_client_id
                                                                                    GOOGLE_CLIENT_SECRET=your_google_client_secret
                                                                                    NEXTAUTH_URL=http://localhost:8080
                                                                                    NEXTAUTH_SECRET=your_nextauth_secret
                                                                                    ```

                                                                                    ---

                                                                                    ## üß† **üîπ AGENT BEHAVIOR RULES**

                                                                                    ### **‚úÖ MANDATORY DOs:**

                                                                                    1. **AI Integration Rules:**
                                                                                       - ‚úÖ **ALWAYS use Vercel AI SDK v5** - Never direct API calls
                                                                                          - ‚úÖ **Route through ai-gateway-config.ts** for all AI operations
                                                                                             - ‚úÖ **Support multi-provider fallbacks** automatically
                                                                                                - ‚úÖ **Track model usage** in database for analytics

                                                                                                2. **UI/UX Standards:**
                                                                                                   - ‚úÖ **Once UI System only** - No external component libraries
                                                                                                      - ‚úÖ **Tailwind CSS utilities only** - No custom CSS
                                                                                                         - ‚úÖ **RTL Arabic support** - All text and layouts
                                                                                                            - ‚úÖ **Minimal, clean design** - Follow existing patterns

                                                                                                            3. **Code Structure:**
                                                                                                               - ‚úÖ **Work within existing files** - Don't create new layout systems
                                                                                                                  - ‚úÖ **Use TypeScript strictly** - Full type safety
                                                                                                                     - ‚úÖ **Follow Drizzle ORM patterns** - For database operations
                                                                                                                        - ‚úÖ **Implement proper error handling** - With user-friendly messages

                                                                                                                        ### **‚ùå CRITICAL DON'Ts:**

                                                                                                                        1. **Forbidden Practices:**
                                                                                                                           - ‚ùå **NO direct API calls** - Must use Vercel AI SDK
                                                                                                                              - ‚ùå **NO external UI libraries** - MUI/Chakra/Ant Design forbidden
                                                                                                                                 - ‚ùå **NO custom CSS files** - Tailwind utilities only
                                                                                                                                    - ‚ùå **NO layout system changes** - Respect Once UI structure

                                                                                                                                    2. **AI Integration Restrictions:**
                                                                                                                                       - ‚ùå **NO bypassing ai-gateway-config.ts** - All providers must go through it
                                                                                                                                          - ‚ùå **NO hardcoded API endpoints** - Use environment variables
                                                                                                                                             - ‚ùå **NO ignoring quota limits** - Enforce 30 generations/month
                                                                                                                                                - ‚ùå **NO direct database queries** - Use Drizzle ORM

                                                                                                                                                ---

                                                                                                                                                ## üéØ **üîπ COMMON DEVELOPMENT TASKS**

                                                                                                                                                ### **AI Generation Enhancement:**
                                                                                                                                                ```typescript
                                                                                                                                                // Enhance generation flow in Generator.tsx
                                                                                                                                                1. Integrate model selection with real-time availability
                                                                                                                                                2. Add loading states specific to each AI provider  
                                                                                                                                                3. Implement cost tracking and quota warnings
                                                                                                                                                4. Add generation time estimates and progress indicators
                                                                                                                                                5. Handle provider failures with automatic fallbacks
                                                                                                                                                ```

                                                                                                                                                ### **Admin Dashboard Development:**
                                                                                                                                                ```typescript
                                                                                                                                                // Build admin interfaces for:
                                                                                                                                                ‚îú‚îÄ‚îÄ /admin/users - User management + quota controls
                                                                                                                                                ‚îú‚îÄ‚îÄ /admin/styles - JSON prompt template editor
                                                                                                                                                ‚îú‚îÄ‚îÄ /admin/analytics - AI usage metrics and costs
                                                                                                                                                ‚îî‚îÄ‚îÄ /admin/models - Provider configuration and status
                                                                                                                                                ```

                                                                                                                                                ### **Database Operations:**
                                                                                                                                                ```typescript
                                                                                                                                                // All database work through Drizzle ORM:
                                                                                                                                                ‚îú‚îÄ‚îÄ User quota management and reset cycles
                                                                                                                                                ‚îú‚îÄ‚îÄ Image metadata with model tracking
                                                                                                                                                ‚îú‚îÄ‚îÄ Style template CRUD operations
                                                                                                                                                ‚îî‚îÄ‚îÄ Analytics data aggregation
                                                                                                                                                ```

                                                                                                                                                ---

                                                                                                                                                ## üìä **üîπ PERFORMANCE & MONITORING**

                                                                                                                                                ### **AI Gateway Analytics:**
                                                                                                                                                ```typescript
                                                                                                                                                // Built-in observability features:
                                                                                                                                                ‚îú‚îÄ‚îÄ Request tracing with Vercel trace IDs
                                                                                                                                                ‚îú‚îÄ‚îÄ Generation time monitoring
                                                                                                                                                ‚îú‚îÄ‚îÄ Cost tracking per model/provider
                                                                                                                                                ‚îú‚îÄ‚îÄ Success/failure rate analytics
                                                                                                                                                ‚îú‚îÄ‚îÄ Quota usage patterns
                                                                                                                                                ‚îî‚îÄ‚îÄ Provider performance comparison
                                                                                                                                                ```

                                                                                                                                                ### **Frontend Performance:**
                                                                                                                                                ```typescript
                                                                                                                                                // Optimization requirements:
                                                                                                                                                ‚îú‚îÄ‚îÄ Lazy loading for large image galleries
                                                                                                                                                ‚îú‚îÄ‚îÄ Real-time model availability checking
                                                                                                                                                ‚îú‚îÄ‚îÄ Efficient state management for generation flows
                                                                                                                                                ‚îú‚îÄ‚îÄ Error boundary implementation
                                                                                                                                                ‚îî‚îÄ‚îÄ Loading state optimization
                                                                                                                                                ```

                                                                                                                                                ---

                                                                                                                                                ## üöÄ **üîπ DEPLOYMENT & SCALING**

                                                                                                                                                ### **Production Ready Features:**
                                                                                                                                                - ‚úÖ **Enterprise AI Gateway** - Vercel infrastructure
                                                                                                                                                - ‚úÖ **Multi-provider redundancy** - Automatic failover
                                                                                                                                                - ‚úÖ **Usage analytics** - Comprehensive monitoring
                                                                                                                                                - ‚úÖ **Cost optimization** - Intelligent model routing
                                                                                                                                                - ‚úÖ **Global performance** - Edge network optimization

                                                                                                                                                ### **Scaling Considerations:**
                                                                                                                                                - üìä **Monitor quota usage** patterns for optimization
                                                                                                                                                - üîÑ **Implement caching strategies** for repeated prompts
                                                                                                                                                - üìà **Track model performance** for intelligent routing
                                                                                                                                                - üí∞ **Optimize costs** through usage analytics

                                                                                                                                                ---

                                                                                                                                                ## üéâ **üîπ READY FOR EXECUTION**

                                                                                                                                                ### **Current Development Server:**
                                                                                                                                                **URL:** http://localhost:8080  
                                                                                                                                                **Status:** Running with Vercel AI Gateway integration

                                                                                                                                                ### **Immediate Tasks Ready:**
                                                                                                                                                1. ‚úÖ **AI Generation Flow** - Fully integrated with multi-provider support
                                                                                                                                                2. ‚úÖ **Model Selection UI** - Dynamic discovery with real-time data
                                                                                                                                                3. üöß **Admin Dashboards** - User and style management (in progress)
                                                                                                                                                4. üöß **Analytics Dashboard** - Usage and cost tracking (ready for implementation)

                                                                                                                                                ### **Next Development Priorities:**
                                                                                                                                                1. **Complete admin interfaces** for users and styles management
                                                                                                                                                2. **Implement advanced analytics** for AI usage optimization  
                                                                                                                                                3. **Add generation history** with detailed model tracking
                                                                                                                                                4. **Enhance quota management** with usage predictions

                                                                                                                                                ---

                                                                                                                                                ## üìû **üîπ SUPPORT & DOCUMENTATION**

                                                                                                                                                ### **Technical Documentation:**
                                                                                                                                                - **`VERCEL_AI_GATEWAY_SETUP.md`** - Complete integration guide
                                                                                                                                                - **`OPENAI_SETUP.md`** - Multi-provider configuration
                                                                                                                                                - **`AI_GATEWAY_IMPLEMENTATION.md`** - Architecture overview

                                                                                                                                                ### **Development Guidelines:**
                                                                                                                                                - **Always prioritize Vercel AI SDK** over direct API integrations
                                                                                                                                                - **Maintain strict UI consistency** with Once UI System
                                                                                                                                                - **Implement comprehensive error handling** for all AI operations
                                                                                                                                                - **Track all interactions** for analytics and optimization

                                                                                                                                                ---

                                                                                                                                                **üéØ Your MADAR AI platform is now enterprise-ready with advanced AI gateway integration, multi-provider support, and comprehensive monitoring capabilities!**